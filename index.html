<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Matisov X ‚Äî Cyber Samurai FULL</title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        :root { --neon: #00d2ff; --bg: #010205; }
        
        /* –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –∂–µ—Å—Ç—ñ–≤ –¥–ª—è –≥—Ä–∏ 5 –ø–∞–ª—å—Ü—è–º–∏ */
        * { 
            -webkit-tap-highlight-color: transparent; 
            user-select: none; 
            touch-action: none; 
        }
        
        body { 
            margin: 0; background: var(--bg); color: #fff; 
            font-family: 'Orbitron', sans-serif; overflow: hidden; height: 100vh;
        }

        .glass { background: rgba(255,255,255,0.05); border: 1px solid rgba(0,210,255,0.2); border-radius: 20px; }
        .btn-neon { background: var(--neon); color: #000; font-weight: 900; border-radius: 12px; transition: 0.1s; }
        .btn-neon:active { transform: scale(0.95); }

        /* –ï–∫—Ä–∞–Ω–∏ –ø–æ–≤–µ—Ä—Ö –æ—Å–Ω–æ–≤–Ω–æ–≥–æ */
        #hubModal, #secretScreen { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 2000; 
            display: none; flex-direction: column; padding: 25px; 
            animation: fadeIn 0.2s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        #hero { 
            height: 45vh; transition: transform 0.05s ease-out; 
            pointer-events: none; will-change: transform;
            filter: drop-shadow(0 0 20px var(--neon));
        }

        .tap-text {
            position: absolute; color: var(--neon); font-weight: 900; pointer-events: none;
            animation: floatUp 0.6s ease-out forwards; font-size: 2rem; z-index: 3000;
            text-shadow: 0 0 10px var(--neon);
        }
        @keyframes floatUp { to { transform: translateY(-120px); opacity: 0; } }

        .close-icon { font-size: 2.5rem; cursor: pointer; line-height: 1; color: #fff; }
    </style>
</head>
<body>

<div class="flex flex-col h-screen p-5" id="mainGame">
    <header class="flex justify-between items-start mb-4">
        <div onclick="openScreen('secretScreen')" class="cursor-pointer">
            <h1 class="text-2xl font-black text-cyan-400">MATISOV X</h1>
            <div id="lvlHeader" class="text-[9px] bg-cyan-900 px-2 py-0.5 rounded text-white mt-1 uppercase">LVL 1 ‚Ä¢ RECRUIT</div>
        </div>
        <div class="text-right">
            <div class="text-[10px] opacity-50 uppercase font-black tracking-widest">MX Balance</div>
            <div id="balance" class="text-3xl font-black tracking-tighter">0</div>
        </div>
    </header>

    <div class="flex-grow flex items-center justify-center relative" id="clickArea">
        <img id="hero" src="https://raw.githubusercontent.com/CUBERIONAI/Matisov-X/main/file_0000000008b471f48ebdb6f35b1b1a5a.png">
    </div>

    <footer class="space-y-4 mb-2">
        <div class="glass p-4">
            <div class="flex justify-between text-[10px] mb-1.5 font-black uppercase">
                <span class="text-cyan-400">‚ö° Energy</span>
                <span id="energyStat">1000 / 1000</span>
            </div>
            <div class="h-2.5 bg-gray-900 rounded-full overflow-hidden border border-white/5">
                <div id="energyBar" class="h-full bg-cyan-400 shadow-[0_0_10px_#00d2ff]"></div>
            </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
            <button onclick="openScreen('hubModal')" class="btn-neon py-4 text-xs font-black uppercase tracking-widest">Hub & Tasks</button>
            <button onclick="openScreen('secretScreen')" class="bg-white/5 border border-white/10 rounded-xl py-4 text-xs font-black uppercase tracking-widest">Profile</button>
        </div>
    </footer>
</div>

<div id="hubModal">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-black text-cyan-400 uppercase italic tracking-widest">Cyber Hub</h2>
        <div onclick="closeScreen('hubModal')" class="close-icon">‚úï</div>
    </div>
    <div class="overflow-y-auto flex-grow space-y-8">
        <section>
            <h3 class="text-[11px] text-gray-500 font-black uppercase tracking-[0.2em] mb-4">Missions (1M MX each)</h3>
            <div id="missionList" class="space-y-3"></div>
        </section>
        <section>
            <h3 class="text-[11px] text-gray-500 font-black uppercase tracking-[0.2em] mb-4">Augmentations</h3>
            <div id="upgradeList" class="space-y-3"></div>
        </section>
    </div>
</div>

<div id="secretScreen">
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-xl font-black text-cyan-400 uppercase italic">Cyber Profile</h2>
        <div onclick="closeScreen('secretScreen')" class="close-icon">‚úï</div>
    </div>
    
    <div class="flex flex-col items-center mb-8">
        <div class="relative">
            <img id="uAvatar" src="" class="w-24 h-24 rounded-full border-4 border-cyan-400 p-1 shadow-[0_0_20px_#00d2ff]">
            <div id="uLvlBadge" class="absolute -bottom-2 left-1/2 -translate-x-1/2 bg-cyan-400 text-black text-[10px] font-black px-4 py-0.5 rounded-full uppercase">LVL 1</div>
        </div>
        <div id="uName" class="font-black text-xl mt-4 tracking-widest uppercase">GUEST SAMURAI</div>
    </div>

    <div id="ton-connect-button" class="flex justify-center mb-6"></div>
    
    <div class="space-y-4">
        <div class="glass p-5 flex justify-between items-center">
            <div>
                <p class="text-[10px] opacity-50 uppercase font-black">TON Balance</p>
                <p id="tonStatus" class="text-xs font-bold text-red-500 mt-1 uppercase">Disconnected</p>
            </div>
            <button onclick="TG.showAlert('TON Transactions integration in progress...')" class="text-[10px] bg-white/10 px-3 py-2 rounded-lg font-black uppercase">Refill</button>
        </div>
        <div class="glass p-5 flex justify-between items-center">
            <span class="text-[10px] opacity-50 uppercase font-black">Next Level Progress</span>
            <div class="w-1/2 h-1.5 bg-gray-900 rounded-full overflow-hidden">
                <div id="lvlProgressBar" class="h-full bg-cyan-400 w-0"></div>
            </div>
        </div>
    </div>
</div>

<script>
const TG = window.Telegram.WebApp;
const UID = TG.initDataUnsafe?.user?.id || "local_dev";
TG.expand();

// TON Connect Init
const tonConnectUI = new TONConnectUI.TonConnectUI({
    manifestUrl: 'https://raw.githubusercontent.com/ton-connect/demo-dapp/main/public/tonconnect-manifest.json',
    buttonRootId: 'ton-connect-button'
});

// –ì–ª–æ–±–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω –≥—Ä–∏ (–¢–ó –ø—É–Ω–∫—Ç 8)
let state = {
    bal: parseInt(localStorage.getItem(`mx_bal_${UID}`)) || 0,
    lvl: parseInt(localStorage.getItem(`mx_lvl_${UID}`)) || 1,
    e: 1000,
    hnd: parseInt(localStorage.getItem(`mx_hnd_${UID}`)) || 0, // –ì—ñ–ø–µ—Ä –∫—ñ–±–µ—Ä —Ä—É–∫–∏
    swd: parseInt(localStorage.getItem(`mx_swd_${UID}`)) || 0, // –°–∏–ª–∞ –º–µ—á–∞
    ai: parseInt(localStorage.getItem(`mx_ai_${UID}`)) || 0,   // –°—É–ø–µ—Ä —Å–∏–ª–∏ AI
    tasks: JSON.parse(localStorage.getItem(`mx_tsk_${UID}`)) || []
};

const MISSIONS = [
    { id: 'm1', title: 'üì¢ Telegram Channel', reward: 1000000, url: 'https://t.me/Matisov_X' },
    { id: 'm2', title: 'üí¨ Telegram Chat', reward: 1000000, url: 'https://t.me/MatisovX' },
    { id: 'm3', title: '‚ñ∂Ô∏è YouTube Sub', reward: 1000000, url: 'https://www.youtube.com/@MatisovX' },
    { id: 'm4', title: 'üì∏ Instagram', reward: 1000000, url: 'https://www.instagram.com/matisov.x' },
    { id: 'm5', title: '‚ùå X (Twitter)', reward: 1000000, url: 'https://x.com/matisovx' },
    { id: 'ton', title: 'üíé Connect TON Wallet', reward: 100000, url: '#' }
];

function save() {
    localStorage.setItem(`mx_bal_${UID}`, state.bal);
    localStorage.setItem(`mx_lvl_${UID}`, state.lvl);
    localStorage.setItem(`mx_hnd_${UID}`, state.hnd);
    localStorage.setItem(`mx_swd_${UID}`, state.swd);
    localStorage.setItem(`mx_ai_${UID}`, state.ai);
    localStorage.setItem(`mx_tsk_${UID}`, JSON.stringify(state.tasks));
}

function getExpNext() { return Math.floor(100000 * Math.pow(1.8, state.lvl - 1)); }

function updateUI() {
    const nextExp = getExpNext();
    if (state.bal >= nextExp) {
        state.lvl++;
        state.bal -= nextExp;
        TG.HapticFeedback.notificationOccurred('success');
    }

    document.getElementById('balance').textContent = state.bal.toLocaleString();
    
    const maxE = 1000 + (state.hnd * 200);
    document.getElementById('energyStat').textContent = `${Math.floor(state.e)} / ${maxE}`;
    document.getElementById('energyBar').style.width = (state.e / maxE * 100) + "%";
    
    const ranks = ["Recruit", "Warrior", "Samurai", "Cyber Ronin", "Shogun", "Matisov Chosen"];
    const rIdx = Math.min(state.lvl - 1, ranks.length - 1);
    const lvlText = `LVL ${state.lvl} ‚Ä¢ ${ranks[rIdx]}`;
    document.getElementById('lvlHeader').textContent = lvlText;
    document.getElementById('uLvlBadge').textContent = `LVL ${state.lvl}`;
    document.getElementById('lvlProgressBar').style.width = (state.bal / nextExp * 100) + "%";

    if(TG.initDataUnsafe?.user) {
        document.getElementById('uName').textContent = (TG.initDataUnsafe.user.username || TG.initDataUnsafe.user.first_name).toUpperCase();
        document.getElementById('uAvatar').src = TG.initDataUnsafe.user.photo_url || 'https://via.placeholder.com/100';
    }
}

// –ö–ª—ñ–∫–µ—Ä (–¢–ó –ø—É–Ω–∫—Ç 2.1, 7)
document.getElementById('clickArea').addEventListener('touchstart', (e) => {
    e.preventDefault();
    if(state.e < 1) return;

    Array.from(e.changedTouches).forEach(touch => {
        if(state.e < 1) return;
        state.e -= 1;
        const tapPower = (1 + state.swd) * (1 + state.ai); // AI —Å—É–ø–µ—Ä —Å–∏–ª–∞ –º–Ω–æ–∂–∏—Ç—å —Ç–∞–ø
        state.bal += tapPower;

        const p = document.createElement('div');
        p.className = 'tap-text';
        p.style.left = touch.clientX + 'px';
        p.style.top = touch.clientY + 'px';
        p.textContent = `+${tapPower}`;
        document.body.appendChild(p);
        setTimeout(() => p.remove(), 600);
    });

    const hero = document.getElementById('hero');
    hero.style.transform = 'scale(0.95) rotate(-2deg)';
    setTimeout(() => hero.style.transform = 'scale(1) rotate(0)', 50);

    updateUI(); save();
    TG.HapticFeedback.impactOccurred('medium');
});

// –°–µ–∫—Ä–µ—Ç–Ω–∏–π –µ–∫—Ä–∞–Ω —Ç–∞ Hub
function openScreen(id) { 
    document.getElementById(id).style.display = 'flex'; 
    if(id === 'hubModal') renderHub();
    TG.HapticFeedback.impactOccurred('light');
}
function closeScreen(id) { document.getElementById(id).style.display = 'none'; }

function renderHub() {
    const mList = document.getElementById('missionList');
    mList.innerHTML = MISSIONS.map(m => {
        const done = state.tasks.includes(m.id);
        return `
        <div class="glass p-4 flex justify-between items-center">
            <div><p class="text-[11px] font-black uppercase text-white">${m.title}</p><p class="text-[9px] text-green-400">+${m.reward.toLocaleString()} MX</p></div>
            ${done ? '<span class="text-green-500 text-[10px] font-black">DONE</span>' : 
            `<button onclick="verifyTask('${m.id}')" class="bg-white text-black text-[10px] font-black px-4 py-2 rounded-lg uppercase">GO</button>`}
        </div>`;
    }).join('');

    const uList = document.getElementById('upgradeList');
    const upgs = [
        { id: 'swd', name: 'Sword Power', lvl: state.swd, desc: '+MX per tap', cost: 5000 * Math.pow(2.5, state.swd) },
        { id: 'hnd', name: 'Cyber Hands', lvl: state.hnd, desc: '+Max Energy & Regen', cost: 10000 * Math.pow(2.2, state.hnd) },
        { id: 'ai', name: 'AI Super Power', lvl: state.ai, desc: 'Multi-tap multiplier', cost: 50000 * Math.pow(5, state.ai) }
    ];
    uList.innerHTML = upgs.map(u => `
        <div class="glass p-4 flex justify-between items-center">
            <div><p class="text-xs font-black uppercase text-white">${u.name} (Lvl ${u.lvl})</p><p class="text-[9px] opacity-50">${u.desc}</p></div>
            <button onclick="buy('${u.id}', ${u.cost})" class="btn-neon text-[10px] px-4 py-2 uppercase font-black">${Math.floor(u.cost).toLocaleString()}</button>
        </div>`).join('');
}

function verifyTask(id) {
    const t = MISSIONS.find(m => m.id === id);
    if(id === 'ton') {
        if(tonConnectUI.connected) claimTask(id, t.reward);
        else TG.showAlert("Please connect wallet in Profile!");
    } else {
        TG.openLink(t.url);
        setTimeout(() => {
            TG.showConfirm("Mission verification: Did you join?", (ok) => { if(ok) claimTask(id, t.reward); });
        }, 2000);
    }
}

function claimTask(id, reward) {
    if(!state.tasks.includes(id)) {
        state.tasks.push(id); state.bal += reward;
        save(); updateUI(); renderHub();
        TG.HapticFeedback.notificationOccurred('success');
    }
}

function buy(key, cost) {
    if(state.bal >= cost) {
        state.bal -= cost; state[key]++;
        save(); updateUI(); renderHub();
        TG.HapticFeedback.notificationOccurred('success');
    } else TG.showAlert("Insufficient MX!");
}

// TON Connect
tonConnectUI.onStatusChange(wallet => {
    const s = document.getElementById('tonStatus');
    if(wallet) { s.textContent = "CONNECTED"; s.className = "text-green-400 font-bold uppercase"; }
    else { s.textContent = "DISCONNECTED"; s.className = "text-red-500 font-bold uppercase"; }
});

// –†–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –µ–Ω–µ—Ä–≥—ñ—ó
setInterval(() => {
    const max = 1000 + (state.hnd * 200);
    if(state.e < max) {
        state.e = Math.min(max, state.e + (2 + state.hnd));
        updateUI();
    }
}, 1000);

updateUI();
</script>
</body>
</html>
