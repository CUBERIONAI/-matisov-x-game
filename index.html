<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Matisov X — Cyber Samurai</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

:root { --neon: #00d2ff; --bg: #02040a; }

* { -webkit-tap-highlight-color: transparent; user-select: none; touch-action: manipulation; }

body {
  margin: 0; background: radial-gradient(circle at 50% 30%, #0b2a44, var(--bg));
  color: #fff; font-family: 'Orbitron', sans-serif; overflow: hidden; height: 100vh;
}

.viewport { position: relative; height: 60vh; overflow: hidden; cursor: pointer; }
.cyber-floor {
  position: absolute; bottom: -60%; left: -50%; width: 200%; height: 200%;
  background: linear-gradient(var(--neon) 1px, transparent 1px), linear-gradient(90deg, var(--neon) 1px, transparent 1px);
  background-size: 80px 80px; opacity: .15; transform: rotateX(70deg);
}

.hero-wrap {
  position: absolute; bottom: 10%; left: 50%; transform: translateX(-50%);
  filter: drop-shadow(0 0 30px var(--neon)); transition: transform 0.1s;
}
.hero-wrap:active { transform: translateX(-50%) scale(0.95); }
#hero { height: 45vh; animation: idle 3s ease-in-out infinite; pointer-events: none; }
@keyframes idle { 0%, 100% { transform: translateY(0) } 50% { transform: translateY(-15px) } }

.tap-text {
  position: absolute; font-size: 2rem; font-weight: 900; color: var(--neon);
  pointer-events: none; animation: float .6s forwards; z-index: 100;
}
@keyframes float { to { transform: translateY(-150px); opacity: 0; } }

#upgradeMenu {
  position: fixed; inset: 0; background: rgba(0,0,0,0.9);
  backdrop-filter: blur(10px); z-index: 100; display: none;
  flex-direction: column; padding: 20px;
}
.upgrade-panel {
  background: #0b1a2a; border: 1px solid var(--neon); border-radius: 20px;
  padding: 20px; width: 100%; max-width: 400px; margin: auto; overflow-y: auto;
}
.upgrade-card {
  background: rgba(255,255,255,0.05); padding: 12px; border-radius: 15px;
  display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;
}
.upgrade-card button {
  background: var(--neon); color: #000; font-weight: bold; padding: 8px 15px; border-radius: 10px;
}
.upgrade-card button:disabled { background: #444; color: #888; }
</style>
</head>
<body>

<header class="p-6 flex justify-between items-center">
  <div onclick="document.getElementById('upgradeMenu').style.display='flex'">
    <h1 class="text-xl font-black text-cyan-400">MATISOV X</h1>
    <span class="text-[10px] bg-cyan-900 px-2 py-1 rounded">SHOP & TASKS</span>
  </div>
  <div class="text-right">
    <div class="text-[10px] text-blue-400 uppercase">Balance</div>
    <div class="text-2xl font-black" id="balDisplay">0</div>
  </div>
</header>

<main class="viewport" id="tapZone">
  <div class="cyber-floor"></div>
  <div class="hero-wrap">
    <img id="hero" src="https://raw.githubusercontent.com/CUBERIONAI/Matisov-X/main/file_0000000008b471f48ebdb6f35b1b1a5a.png" onerror="this.src='https://via.placeholder.com/300x500?text=Samurai'">
  </div>
</main>

<div class="px-6 -mt-10">
  <div class="bg-black/60 rounded-2xl p-4 border border-white/10">
    <div class="flex justify-between text-[10px] mb-1">
      <span>ENERGY</span>
      <span id="energyText">1000 / 1000</span>
    </div>
    <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
      <div id="energyBar" class="h-full bg-cyan-400 shadow-[0_0_10px_#00d2ff]"></div>
    </div>
  </div>
</div>

<div id="upgradeMenu">
  <div class="upgrade-panel">
    <h2 class="text-center text-cyan-400 font-bold mb-4">UPGRADES</h2>
    
    <div class="upgrade-card">
      <div>
        <div class="text-sm font-bold">Cyber Hands</div>
        <div id="hLevel" class="text-[10px] text-cyan-300">Lvl 0</div>
      </div>
      <button onclick="buy('hands')" id="hBtn">500</button>
    </div>

    <div class="upgrade-card">
      <div>
        <div class="text-sm font-bold">Sword Power</div>
        <div id="sLevel" class="text-[10px] text-cyan-300">Lvl 0</div>
      </div>
      <button onclick="buy('sword')" id="sBtn">100</button>
    </div>

    <h2 class="text-center text-yellow-400 font-bold my-4">TASKS</h2>
    <div class="bg-white/5 p-3 rounded-xl flex justify-between items-center mb-2">
      <div class="text-[10px]">Join Channel<br><span class="text-green-400">+50,000 MX</span></div>
      <button onclick="doTask(this, 50000)" class="bg-white text-black text-[10px] px-3 py-1 rounded font-bold">GO</button>
    </div>

    <button onclick="document.getElementById('upgradeMenu').style.display='none'" class="w-full mt-4 bg-red-500/20 text-red-500 py-2 rounded-xl font-bold">CLOSE</button>
  </div>
</div>

<script>
const TG = window.Telegram.WebApp;
const UID = TG.initDataUnsafe?.user?.id || "guest";

let state = {
  bal: parseInt(localStorage.getItem('mx_bal_'+UID)) || 0,
  hands: parseInt(localStorage.getItem('mx_hnd_'+UID)) || 0,
  sword: parseInt(localStorage.getItem('mx_swd_'+UID)) || 0,
  e: parseInt(localStorage.getItem('mx_ene_'+UID)) || 1000
};

function save() {
  localStorage.setItem('mx_bal_'+UID, state.bal);
  localStorage.setItem('mx_hnd_'+UID, state.hands);
  localStorage.setItem('mx_swd_'+UID, state.sword);
  localStorage.setItem('mx_ene_'+UID, state.e);
}

function render() {
  const maxE = 1000 + (state.hands * 100);
  const sCost = Math.floor(100 * Math.pow(1.5, state.sword));
  const hCost = Math.floor(500 * Math.pow(1.5, state.hands));

  document.getElementById('balDisplay').textContent = state.bal.toLocaleString();
  document.getElementById('energyText').textContent = `${state.e} / ${maxE}`;
  document.getElementById('energyBar').style.width = (state.e / maxE * 100) + "%";
  
  document.getElementById('sLevel').textContent = `Lvl ${state.sword} (+${state.sword+1} per tap)`;
  document.getElementById('sBtn').textContent = sCost.toLocaleString();
  document.getElementById('sBtn').disabled = state.bal < sCost;

  document.getElementById('hLevel').textContent = `Lvl ${state.hands} (+100 Energy)`;
  document.getElementById('hBtn').textContent = hCost.toLocaleString();
  document.getElementById('hBtn').disabled = state.bal < hCost;
}

document.getElementById('tapZone').addEventListener('touchstart', (e) => {
  e.preventDefault();
  Array.from(e.changedTouches).forEach(touch => {
    if(state.e <= 0) return;
    state.e--;
    const gain = 1 + state.sword;
    state.bal += gain;

    const t = document.createElement('div');
    t.className = 'tap-text';
    t.style.left = touch.clientX + 'px';
    t.style.top = touch.clientY + 'px';
    t.textContent = `+${gain}`;
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 600);
    TG.HapticFeedback.impactOccurred('light');
  });
  render();
  save();
});

function buy(type) {
  const sCost = Math.floor(100 * Math.pow(1.5, state.sword));
  const hCost = Math.floor(500 * Math.pow(1.5, state.hands));
  
  if(type === 'sword' && state.bal >= sCost) {
    state.bal -= sCost; state.sword++;
  } else if(type === 'hands' && state.bal >= hCost) {
    state.bal -= hCost; state.hands++;
  }
  TG.HapticFeedback.notificationOccurred('success');
  render(); save();
}

function doTask(btn, reward) {
  TG.openLink('https://t.me/your_link');
  btn.disabled = true; btn.textContent = "...";
  setTimeout(() => {
    state.bal += reward;
    btn.textContent = "DONE";
    render(); save();
  }, 3000);
}

// Регенерація
setInterval(() => {
  const maxE = 1000 + (state.hands * 100);
  if(state.e < maxE) {
    state.e = Math.min(maxE, state.e + 2);
    render();
  }
}, 1000);

render();
</script>

</body>
  </html>
  
